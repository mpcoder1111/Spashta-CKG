# Spashta-CKG 2.0: The Code Knowledge Graph for Agentic Coding

> **Spashta** (à¤¸à¥à¤ªà¤·à¥à¤Ÿ) = *Clarity* in Sanskrit. Clear, unambiguous, deterministic.

**Spashta-CKG 2.0** is a modular, universal architecture designed to give AI Coding Agents **"Situational Awareness"** of any codebase.

It solves the **"Lost in the Woods"** problem where AI agents hallucinate file paths, misunderstand architecture, or break existing logic because they lack a structured map of the project.

> **Note:** Spashta-CKG is designed for use with **Agentic IDEs** (Antigravity, Cursor, Windsurf, Gemini CLI, etc.)
>
> **Currently Supported:**
> - **Languages:** Python, HTML, CSS
> - **Frameworks:** Django, FastAPI, HTMX

---

## ğŸ¤” Why Spashta-CKG?

Most Agentic IDEs use embeddings for semantic search, but still rely on probabilistic retrieval rather than explicit structural queries like dependency graphs.

Spashta-CKG introduces **Deterministic Architectural Memory**:

| Benefit | Without Spashta | With Spashta |
|---------|-----------------|--------------|
| â±ï¸ **Time Saving** | Agent explores files repeatedly | Agent queries pre-built graph instantly |
| ğŸ” **Code Clarity** | Agent guesses project structure | Agent knows file, function, line numbers, docstrings & dependencies |
| ğŸš« **Hallucinations** | Agent invents non-existent code | Agent queries facts, doesn't guess |
| ğŸ’° **Token Usage** | Wastes tokens reading files | Efficient queries, minimal token use |
| ğŸ¯ **Impact Analysis** | Agent manually traces dependencies | Query "what calls this?" or "what does this depend on?" |
| ğŸ§˜ **Peace of Mind** | Hope the agent understood correctly | Trust the deterministic knowledge graph |

### ğŸ“Š Estimated Savings

Based on testing with mid-sized Django projects:

```
â±ï¸ Coding Time      â¬‡ï¸ 60% reduction
ğŸ’° Token Usage      â¬‡ï¸ 60% savings  
ğŸš« Hallucinations   â¬‡ï¸ Significantly reduced
```

| Metric | Estimated Improvement |
|--------|----------------------|
| **Coding Time** | ~60% reduction |
| **Token Usage** | ~60% savings |
| **Hallucinations** | Significantly reduced |

> ğŸ’¡ *These are indicative figures. Test on your own projects to measure actual impact!*
>
> ğŸ“– See [AI Agent's Testimony on Spashta](_docs/Testimony_on_Spashta2.md) for real-world usage experience.

### ğŸ§  Dual-Brain Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STAGE 1: BODY (Structure)           STAGE 2: MIND (Semantics)  â”‚
â”‚                                                                  â”‚
â”‚  100% Accurate AST-based facts   +   AI-enriched understanding  â”‚
â”‚  Generated by builders               Added by adapters & LLM    â”‚
â”‚                                                                  â”‚
â”‚  "What exists"                       "What it means"             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”“ Open & Extensible Architecture

Spashta is designed to grow with your needs:

| Layer | Currently Supported | Easy to Add | What to Create |
|-------|---------------------|-------------|----------------|
| **Languages** | Python, HTML, CSS | Java, PHP, JavaScript, Go, Rust, etc. | Builder script |
| **Frameworks** | Django, FastAPI, HTMX | Flask, Express, React, Spring, Laravel, etc. | `framework_mapping.json` |

> ğŸš€ **Contribute!** Adding a new language or framework doesn't touch the core â€” just add a builder or adapter.

## ğŸš€ What's New in 2.0?

Spashta 2.0 is a **complete architectural redesign** from 1.0:

| Feature | Spashta 1.0 | Spashta 2.0                                            |
|---------|-------------|--------------------------------------------------------|
| Design | Monolithic script | Modular, layered architecture                          |
| Languages | Python only | Universal (Python, HTML, CSS, extensible)              |
| Frameworks | Hardcoded | Pluggable Adapters (Django, FastAPI, HTMX, extensible) |
| Enrichment | Single-stage | Two-stage (Rule-based [Programmatic] + LLM)            |
| Extensibility | Copy-paste | Add language/framework without touching core           |

---

## ğŸ—ï¸ Spashta 2.0 Architecture

```
Read from bottom...
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              SPASHTA-CKG 2.0                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚                         AI AGENT / IDE                               â”‚    â”‚
â”‚   â”‚                                                                      â”‚    â”‚
â”‚   â”‚  â€¢ Reads CKG for situational awareness                               â”‚    â”‚
â”‚   â”‚  â€¢ Queries CKG before making changes                                 â”‚    â”‚
â”‚   â”‚  â€¢ Never modifies runtime artifacts                                  â”‚    â”‚
â”‚   â”‚  â€¢ code_knowledge_graph_enriched_by_Agent.json (Agent enriched)      â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                       â”‚ consumes                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚                          RUNTIME                                     â”‚    â”‚
â”‚   â”‚                                                                      â”‚    â”‚
â”‚   â”‚ Orchestrates builders â†’ Merges AST's â†’ Applies adapters â†’ Validates  â”‚    â”‚
â”‚   â”‚                                                                      â”‚    â”‚
â”‚   â”‚  Output:                                                             â”‚    â”‚
â”‚   â”‚   â€¢ code_knowledge_graph_ast.json      (structure)                   â”‚    â”‚
â”‚   â”‚   â€¢ code_knowledge_graph_enriched.json (semantics)                   â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                       â”‚ uses                                  â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚       â”‚                                                               â”‚      â”‚
â”‚   â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚      â”‚
â”‚   â”‚   BUILDERS     â”‚    â”‚    ADAPTERS      â”‚    â”‚    PROJECT      â”‚  â”‚      â”‚
â”‚   â”‚                â”‚    â”‚                  â”‚    â”‚                 â”‚  â”‚      â”‚
â”‚   â”‚  Language      â”‚    â”‚  Framework       â”‚    â”‚  Declaration    â”‚  â”‚      â”‚
â”‚   â”‚  Observers     â”‚    â”‚  Interpreters    â”‚    â”‚  Only           â”‚  â”‚      â”‚
â”‚   â”‚                â”‚    â”‚                  â”‚    â”‚                 â”‚  â”‚      â”‚
â”‚   â”‚  â€¢ Python      â”‚    â”‚  â€¢ Django        â”‚    â”‚  â€¢ profile.json â”‚  â”‚      â”‚
â”‚   â”‚  â€¢ HTML        â”‚    â”‚  â€¢ FastAPI       â”‚    â”‚                 â”‚  â”‚      â”‚
â”‚   â”‚  â€¢ CSS         â”‚    â”‚  â€¢ HTMX          â”‚    â”‚                 â”‚  â”‚      â”‚
â”‚   â”‚  â€¢ (Future)    â”‚    â”‚  â€¢ (Future)      â”‚    â”‚                 â”‚  â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      â”‚
â”‚           â”‚                      â”‚                       â”‚           â”‚      â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚      â”‚
â”‚                                  â”‚ governed by                       â”‚      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚      â”‚
â”‚   â”‚                           CORE                                  â”‚ â”‚      â”‚
â”‚   â”‚                                                                 â”‚ â”‚      â”‚
â”‚   â”‚   The Universal Laws of Software                                â”‚ â”‚      â”‚
â”‚   â”‚                                                                 â”‚ â”‚      â”‚
â”‚   â”‚   â€¢ software_schema/       â†’ What can exist (nodes, edges)      â”‚ â”‚      â”‚
â”‚   â”‚                                                                 â”‚ â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      â”‚
â”‚                                                                       â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§  Understanding the Five Layers

### 1ï¸âƒ£ CORE â€“ The Universal Laws

**Location:** `core/`

**Purpose:** Defines what software fundamentally *is* â€” language-agnostic, framework-agnostic, eternal.

```
core/
â””â”€â”€ software_schema/
    â”œâ”€â”€ nodes.json    # What can exist: File, Function, Class, Template, Route...
    â””â”€â”€ edges.json    # How things connect: calls, imports, renders, depends_on...
```

**Key Insight:**
> The Core Schema is a **superset**. It defines what *can* exist, not what *must* exist.  
> A project without classes is valid. A project without routes is valid.

**Immutability:**
> âš ï¸ Core is **FROZEN**. It never changes for any project. This guarantees universal truth.

---

### 2ï¸âƒ£ BUILDERS â€“ The Observers

**Location:** `builders/`

**Purpose:** Turn language-specific syntax into objective, structural facts â€” nothing more.

```
builders/
â”œâ”€â”€ builder_rules.json      # Global policies (error handling, recursion limits)
â”‚
â”œâ”€â”€ python/
â”‚   â”œâ”€â”€ build_ast.py        # Extract Python structure using native AST
â”‚   â””â”€â”€ language_mapping.json # Python syntax â†’ Core concepts (def â†’ Function)
â”‚
â”œâ”€â”€ html/
â”‚   â”œâ”€â”€ build_dom.py        # Extract HTML structure (templates, assets)
â”‚   â””â”€â”€ language_mapping.json # HTML â†’ Core concepts (file â†’ Template)
â”‚
â”œâ”€â”€ css/
â”‚   â”œâ”€â”€ build_css.py        # Extract CSS selectors and dependencies
â”‚   â””â”€â”€ language_mapping.json # CSS â†’ Core concepts (file â†’ StaticAsset)
â”‚
â””â”€â”€ (future: javascript/, java/, go/...)
```

**What Builders Do:**
- âœ… Parse code using language-native tools
- âœ… Extract nodes: File, Function, Class, Template, Asset
- âœ… Extract edges: calls, imports, renders
- âœ… Record line numbers and docstrings
- âœ… Log ambiguities (dynamic calls, unresolved references)

**What Builders Do NOT Do:**
- âŒ Interpret meaning or intent
- âŒ Apply framework rules
- âŒ Make architectural decisions
- âŒ Guess when uncertain

**Mental Model:**
> ğŸ“· **Builders are cameras.** They observe and record. They never interpret.

---

### 3ï¸âƒ£ ADAPTERS â€“ The Interpreters

**Location:** `adapters/`

**Purpose:** Explain framework-specific meaning on top of structural facts.

```
adapters/
â”œâ”€â”€ django/
â”‚   â””â”€â”€ framework_mapping.json          # Function + render() â†’ View
â”‚   
â”œâ”€â”€ fastapi/
â”‚   â””â”€â”€ (same structure for API-focused mappings)
â”‚
â”œâ”€â”€ htmx/
â”‚   â””â”€â”€ (same structure for interaction patterns)
â”‚
â””â”€â”€ validation/
    â””â”€â”€ validate_adapter.py             # Ensure adapters comply with Core
```

**What Adapters Do:**
- âœ… Add **semantic_role** to nodes (e.g., Function â†’ "View")
- âœ… Map framework constructs to core concepts
- âœ… Verify framework contracts (View must return HttpResponse)

**What Adapters Do NOT Do:**
- âŒ Parse or execute code
- âŒ Mutate graph structure
- âŒ Invent new node types (use semantic roles instead)

**Mental Model:**
> ğŸ“š **Adapters are interpreters.** They explain framework meaning on top of structure.

---

### 4ï¸âƒ£ RUNTIME â€“ The Execution Engine

**Location:** `runtime/`

**Purpose:** Orchestrate builders, merge outputs, apply enrichment, validate results.

```
runtime/
â”œâ”€â”€ build_runtime_ast.py          # Run all builders â†’ raw AST
â”œâ”€â”€ diff_runtime_ast.py           # Detect changes in files. It is used to reduce LLM enrichments on already enriched files.(optional)
â”œâ”€â”€ enrich_runtime_ast.py         # Apply adapter semantics â†’ enriched AST (Rule based)
â”œâ”€â”€ validate_ast_equivalence.py   # Ensure Graph structure unchanged
â”‚
â”œâ”€â”€ code_knowledge_graph_ast.json       # Output: raw structure
â””â”€â”€ code_knowledge_graph_enriched.json  # Output: with semantics
```

**Execution Flow:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. validate_project_profile.py     â”‚  â† Validate project config
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  2. context_loader.py               â”‚  â† Load project context, Language, Framework from profile.json
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  3. build_runtime_ast.py            â”‚  â† Run all language builders
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  4. diff_runtime_ast.py             â”‚  â† Detect changes in files (optional)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  5. enrich_runtime_ast.py           â”‚  â† Apply semantic enrichment based adapter mappings
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  6. validate_ast_equivalence.py     â”‚  â† Verify structure preserved
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Enrichment Levels:**

| Level | Name | Implementation | Nature |
|-------|------|----------------|--------|
| L1 | Adapter Enrichment | Rule-based via Adapters | Deterministic, cheap |
| L2 | LLM Enrichment | AI Agent reasoning | Token-intensive (one-time) |

**Query Tool (`query_spashta.py`):**

The query tool is how AI Agents access the CKG:

```bash
# Find functions by name
python runtime/query_spashta.py search "login" --type Function --json

# Get file location and line numbers
python runtime/query_spashta.py locate "app/views.py::login" --json

# Read actual source code
python runtime/query_spashta.py read "app/views.py::login" --json

# Impact analysis: what breaks if I change this?
python runtime/query_spashta.py impact "app/models.py::User" --depth 3 --json

# Call graph: what does this function call?
python runtime/query_spashta.py call-graph "app/views.py::search" --json
```

| Command | Purpose |
|---------|---------|
| `search` | Find nodes by name/attributes |
| `locate` | Get file path + line numbers |
| `read` | View actual source code |
| `details` | Full node metadata |
| `impact` | Who depends on this? |
| `dependencies` | What does this use? |
| `call-graph` | Function call chains (Python) |
| `stats` | Graph statistics |
| `list-files` | All indexed files |

> ğŸ“– For detailed documentation, see `_docs/Query_Tool_Readme.md`

**Key Constraint:**
> âš ï¸ **Runtime is Spashta-owned.** Projects declare intent; Runtime executes.

---

### 5ï¸âƒ£ PROJECT â€“ The Declarations

**Location:** `project/`

**Purpose:** Declare what THIS project is â€” which languages, which frameworks apply HERE.

```
project/
â”œâ”€â”€ profile.json          # Activation switchboard
â”œâ”€â”€ context_loader.py     # Convert declarations â†’ Python dict. input is profile.json
â”œâ”€â”€ validation/           # Profile validators
â””â”€â”€ runtime_logs/         # Session logs, agent notes
```

**Sample `profile.json`:**
```json
{
    "project_root": "/path/to/your/project",
    "project_type": "web_app",
    "languages": ["python", "html", "css"],
    "frameworks": ["django", "htmx"],
    "excluded": {
        "frameworks": ["fastapi"],
        "languages": ["javascript"]
    }
}
```

**What Profile Does:**
- Tells runtime which builders to run
- Tells runtime which adapters to apply
- Defines what is forbidden
- Sets the scan scope

**Mental Model:**
> ğŸ“‹ **Project says WHAT. Runtime decides HOW.**

---

## ğŸ“Š Architecture Summary

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                 PROJECT                     â”‚
                    â”‚  profile.json â†’ WHAT this project is        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚ declares
                                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                              RUNTIME                                    â”‚
    â”‚                                                                         â”‚
    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
    â”‚    â”‚   BUILDERS   â”‚â”€â”€â”€â–¶â”‚  Merge AST   â”‚â”€â”€â”€â–¶â”‚    ADAPTERS         â”‚     â”‚
    â”‚    â”‚  (Observers) â”‚    â”‚              â”‚    â”‚  (Interpreters)      â”‚     â”‚
    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
    â”‚                                                       â”‚                 â”‚
    â”‚                                                       â–¼                 â”‚
    â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
    â”‚                              â”‚ code_knowledge_graph_enriched.json â”‚     â”‚
    â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚ governed by
                                          â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                   CORE                      â”‚
                    â”‚  software_schema/ â†’ Laws of software        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”’ Immutability Zones & Separation of Responsibility

| Layer | Responsibility | Mutability |
|-------|---------------|------------|
| **Core** | Universal software definitions | â„ï¸ FROZEN |
| **Builders** | Observe syntax | â„ï¸ FROZEN (per language) |
| **Adapters** | Interpret meaning | â„ï¸ FROZEN (per framework) |
| **Runtime** | Execute & merge | ğŸ”§ Spashta-controlled |
| **Project** | Declare intent | ğŸ“ User-configurable |
| **Agents** | Reason & act | ğŸ¤– Autonomous |

**What NEVER happens:**
- âŒ Runtime never guesses
- âŒ Builders never add semantics
- âŒ Adapters never change structure
- âŒ Agents never mutate AST directly

---

## ğŸ› ï¸ How to Use

### ğŸš€ Quick Start (One-Click Option)

The easiest way to use Spashta is to let your AI Agent handle everything automatically:

1. **Copy** the `Spashta-CKG` folder into your project's root directory:
   ```
   YourProject/
   â”œâ”€â”€ Spashta-CKG/      <-- Copy this folder here
   â”œâ”€â”€ your_app/
   â”œâ”€â”€ manage.py
   â””â”€â”€ ...
   ```

2. **Configure** `Spashta-CKG/Spashta_2.0/project/profile.json`:
   - Set `project_root` to your project's absolute path (or use `"."` for current directory)
   - Set `languages` and `frameworks` as needed (check `_meta` for supported values)

3. **Provide this prompt** to your AI Agent:
   ```
   Read and follow: Spashta-CKG/Spashta_2.0/runtime/execution_protocol.json
   ```

That's it! The AI Agent will:
- Validate your configuration
- Build the AST
- Apply L1 enrichment (adapters)
- Ask if you want L2 enrichment (LLM)
- Set up the CKG for querying

> ğŸ’¡ The `execution_protocol.json` contains the complete step-by-step workflow with user confirmations built-in.

**âœ… Your Agent Now Knows About Spashta!**

For future sessions, reinforce this by providing:

```
This project uses Spashta-CKG as its Code Knowledge Graph.

ğŸ“ CKG Location:
   L1 (Adapter-enriched): Spashta-CKG/Spashta_2.0/runtime/code_knowledge_graph_enriched.json
   L2 (LLM-enriched):     Spashta-CKG/Spashta_2.0/runtime/code_knowledge_graph_enriched_by_Agent.json
   (Use L2 if available, otherwise use L1)

ğŸ“Œ Your Rules:
1. Query Spashta-CKG FIRST before reading project files
2. Use: python Spashta-CKG/Spashta_2.0/runtime/query_spashta.py --help
3. If queries are insufficient, you may read source files directly
4. Never modify files in runtime/ â€” these are generated artifacts

Use Spashta as your primary source of truth about this codebase.
```

---

### Manual Steps (Detailed Walkthrough)

If you prefer to run each step manually, or want to understand what happens behind the scenes:

### Step 0: Copy Spashta to Your Project

Copy the `Spashta-CKG` folder into your project's root directory:

```
YourProject/
â”œâ”€â”€ Spashta-CKG/      <-- Copy this folder here
â”œâ”€â”€ your_app/
â”œâ”€â”€ manage.py
â””â”€â”€ ...
```

### Step 1: Configure Your Project

Edit `Spashta-CKG/Spashta_2.0/project/profile.json` to point to your project:

```json
{
    "project_root": "C:/path/to/your/project",
    "project_type": "web_app",
    "languages": ["python", "html", "css"],
    "frameworks": ["django", "htmx"],
    "excluded": {
        "frameworks": ["fastapi"],
        "languages": ["javascript"]
    }
}
```

> âš ï¸ **Important:** `project_root` must be set to the absolute path of the project you want to analyze.

---

### Step 2: Build the Knowledge Graph

Run the following commands from your project's root directory:

```bash
# If your project has a virtual environment, activate it first
# Example: .\venv\Scripts\activate (Windows) or source venv/bin/activate (Linux/Mac)

# Build Raw AST
python Spashta-CKG/Spashta_2.0/runtime/build_runtime_ast.py
```

**What this does:**
- Scans all files in your project matching the declared languages
- Extracts structure using language-native AST parsers (Python's `ast`, HTML parser, CSS regex)
- Creates nodes (File, Function, Class, Template, StaticAsset)
- Creates edges (calls, imports, renders, links)
- Logs ambiguities (dynamic calls, unresolved references)

**Output:** `Spashta-CKG/Spashta_2.0/runtime/code_knowledge_graph_ast.json` â€” pure structural facts

---

### Step 3: Level 1 Enrichment (Adapter-Based)

```bash
python Spashta-CKG/Spashta_2.0/runtime/enrich_runtime_ast.py
```

**What this does:**
- Reads the raw AST from Step 2
- Applies framework-specific semantic roles using Adapter definitions:
  - Django: Function + `render()` â†’ **View**, Class + `models.Model` â†’ **DataModel**
  - FastAPI: Function + `@app.get` â†’ **View**, Class + `BaseModel` â†’ **APIContract**
  - HTMX: Template + `hx-get` â†’ **HTMXInteraction**
- Adds `semantic_role` metadata to nodes
- Validates framework contracts (e.g., View must return HttpResponse)

**Output:** `Spashta-CKG/Spashta_2.0/runtime/code_knowledge_graph_enriched.json` â€” structure + semantic meaning

> âœ… **Level 1 is deterministic, rule-based, and cheap.** It runs in seconds.

---

### Step 3a: Validate Structural Equivalence (Recommended)

```bash
python Spashta-CKG/Spashta_2.0/runtime/validate_ast_equivalence.py
```

**What this does:**
- Ensures the enriched AST preserves the exact structure of the raw AST
- Verifies no nodes or edges were accidentally added/removed during enrichment
- Confirms only semantic metadata was added (no structural mutations)

> ğŸ›¡ï¸ **This is a safety check.** If validation fails, enrichment may have corrupted the graph.

---

### Step 4: Level 2 Enrichment (LLM-Based) â€” Optional

Level 2 enrichment is performed by your **AI Agent** (not by scripts).

**What it does:**
- Adds **business intent** to nodes (e.g., "This view handles user authentication")
- Adds **domain tags** (e.g., `#payments`, `#user-management`)
- Resolves **ambiguities** that static analysis couldn't resolve
- Adds **reasoning notes** for complex code patterns

**How to trigger:**

Provide this prompt to your AI Agent after L1 enrichment:

```
Read and follow: Spashta-CKG/Spashta_2.0/runtime/enrichment_through_LLM/Prompt_For_LLM_Enrichment.txt
```

This prompt internally guides the AI Agent to:
1. Run `python runtime/enrichment_through_LLM/llm_enrich_runtime_ast.py --list-pending`
2. Read two JSON configuration files:
   - `runtime/enrichment_through_LLM/llm_enrichment_rules.json` â€” enrichment rules
   - `runtime/enrichment_through_LLM/llm_enrichment_prompt.json` â€” format & workflow
3. Process each pending file and add semantic metadata
4. Output to: `runtime/code_knowledge_graph_enriched_by_Agent.json`

> ğŸ¤– **Level 2 is performed by the AI Agent after reading each file.** It adds deep semantic understanding that static analysis cannot provide.

---

### Step 5: Use Spashta-CKG with Your AI Agent

#### Sample Prompt to Onboard Your AI Agent:

```
This project uses Spashta-CKG for architectural memory.

ğŸ“ CKG Location: Spashta_2.0/runtime/code_knowledge_graph_enriched.json

The CKG contains:
- All files, functions, classes, templates in the project
- Relationships: calls, imports, renders, depends_on
- Semantic roles: View, DataModel, Template, APIContract, etc.
- Ambiguities: code patterns that couldn't be statically resolved

ğŸ“‹ How to use Spashta:
1. Query CKG FIRST before reading project files
2. Use `Spashta_2.0/runtime/query_spashta.py --help` for easy querying
3. If query results are insufficient, you may read source files directly
4. Never modify files in `runtime/` â€” these are generated artifacts

ğŸ”§ Quick Query Examples:
python runtime/query_spashta.py --list-files
python runtime/query_spashta.py --list-functions
python runtime/query_spashta.py --find "UserView"
python runtime/query_spashta.py --deps "views.py"

Remember: Use Spashta as your primary source of truth about this codebase.

I will now provide the coding task.
```

---

### Execution Flow Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           SPASHTA EXECUTION FLOW                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚
â”‚  â”‚  1. CONFIGURE        â”‚  Edit profile.json â†’ set project_root             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚
â”‚             â”‚                                                                â”‚
â”‚             â–¼                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚
â”‚  â”‚  2. BUILD AST        â”‚  python runtime/build_runtime_ast.py              â”‚
â”‚  â”‚                      â”‚                                                   â”‚
â”‚  â”‚  â†’ Extracts structureâ”‚  Output: code_knowledge_graph_ast.json            â”‚
â”‚  â”‚  â†’ Files, Functions  â”‚          (pure structure, no meaning)             â”‚
â”‚  â”‚  â†’ Calls, Imports    â”‚                                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚
â”‚             â”‚                                                                â”‚
â”‚             â–¼                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚
â”‚  â”‚  3. L1 ENRICH        â”‚  python runtime/enrich_runtime_ast.py             â”‚
â”‚  â”‚     (Adapters)       â”‚                                                   â”‚
â”‚  â”‚                      â”‚  Output: code_knowledge_graph_enriched.json       â”‚
â”‚  â”‚  â†’ Adds semantic_roleâ”‚          (structure + framework semantics)        â”‚
â”‚  â”‚  â†’ Django/FastAPI/   â”‚                                                   â”‚
â”‚  â”‚    HTMX patterns     â”‚  âœ… Deterministic, fast, cheap                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚
â”‚             â”‚                                                                â”‚
â”‚             â–¼                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚
â”‚  â”‚  3a. VALIDATE        â”‚  python runtime/validate_ast_equivalence.py       â”‚
â”‚  â”‚                      â”‚                                                   â”‚
â”‚  â”‚  â†’ Structure intact? â”‚  Ensures enrichment didn't corrupt the graph      â”‚
â”‚  â”‚  â†’ No missing nodes? â”‚  ğŸ›¡ï¸ Safety check before using CKG                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚
â”‚             â”‚                                                                â”‚
â”‚             â–¼                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚
â”‚  â”‚  4. L2 ENRICH        â”‚  AI Agent reads CKG + adds business context       â”‚
â”‚  â”‚     (LLM) [Optional] â”‚                                                   â”‚
â”‚  â”‚                      â”‚  Output: code_knowledge_graph_enriched_by_Agent   â”‚
â”‚  â”‚  â†’ Business intent   â”‚          .json (agent's semantic understanding)   â”‚
â”‚  â”‚  â†’ Domain tags       â”‚                                                   â”‚
â”‚  â”‚  â†’ Resolve ambiguity â”‚  ğŸ¤– Done by AI Agent after reading each file      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚
â”‚             â”‚                                                                â”‚
â”‚             â–¼                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚
â”‚  â”‚  5. USE CKG          â”‚  AI Agent queries CKG for all coding tasks        â”‚
â”‚  â”‚                      â”‚                                                   â”‚
â”‚  â”‚  â†’ query_spashta.py  â”‚  "Query facts, don't guess structure"             â”‚
â”‚  â”‚  â†’ Direct JSON read  â”‚                                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“š Documentation

| Document | Purpose |
|----------|---------|
| `_docs/Spashta2.0_Universal_Architecture_Readme.md` | Complete architecture philosophy |
| `_docs/Spashta_Structure.md` | Why this structure exists |
| `_docs/Runtime_Readme.md` | Runtime execution reference |
| `_docs/adapter_Readme.md` | Complete adapter guide |
| `_docs/Builders_Roadmap.md` | Builder capabilities & roadmap |

---

## ğŸ§  Why Spashta-CKG Architecture Works

### 1. Provides Clear Context for AI
**Problem:** AI agents struggle to understand the "big picture" without reading every file.  
**Solution:** The CKG provides a structural map. Agents instantly know where files are and how they connect.

### 2. Drastically Reduces Hallucinations
**Problem:** AI guesses about dependencies and invents non-existent code.  
**Solution:** Agents query **objective truth** stored in AST JSON. Facts, not probabilities.

### 3. Saves Time and Costs
**Problem:** Re-analyzing codebases for every prompt is slow and expensive.  
**Solution:** Hash-based incremental updates. Only changed files are re-processed.

### 4. Enables Safer Code Changes
**Problem:** Fixing one part often breaks another due to hidden dependencies.  
**Solution:** Explicit dependency mapping enables **impact analysis** before any edit.

### 5. Prevents Architectural Drift
**Problem:** Codebases become "spaghetti code" as layer boundaries are violated.  
**Solution:** Semantic roles and framework contracts help maintain clean architecture.

### 6. Open & Extensible by Design
**Problem:** Most tools are locked to specific languages or frameworks.  
**Solution:** Spashta's modular architecture allows easy addition of new languages (Java, PHP, Go, etc.) and frameworks (Flask, Express, Spring, etc.) without modifying the core.

---

## ğŸ“„ License

Apache 2.0 - Free for personal and commercial use.

---

*Created by [mpcoder1111](https://github.com/mpcoder1111) | Spashta-CKG 2.0*
